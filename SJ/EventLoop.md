# 이벤트 루프

<aside>
📌 이벤트 루프에 대해 설명하기 전에 JS엔진의 특징에 대한 이해가 필요하다.
</aside>

## 자바스크립트의 엔진

- JS는 싱글 스레드로 동작 ⇒ 한 번에 하나의 테스크만 처리할 수 있다(동기 처리)
- 콜 스택과 힙으로 구성되어 있는 JS엔진은 단순히 태스크가 요청되면 콜 스택을 통해 요청된 작업을 **순차적**으로 실행한다.
    
    **콜 스택**: 코드가 실행될 경우 하나씩 stack 형태(LIFO)로 쌓인다.
    **메모리 힙:**메모리 할당이 일어나는 장소 - 선언한 변수, 함수 등이 담겨져 있다.

<aside>
📌 이처럼 자바스크립트의 엔진은 싱글 스레드로 단일 태스크를 동기적으로 처리한다.
그렇다면 비동기는 어떻게 처리할까??
</aside>

### 자바스크립트 비동기

- JS엔진은 자체적으로 비동기 처리를 제공하지 않는다.
- 대신, 비동기 코드는  JS엔진 외부의 정해진 함수(API) 등을 활용할 수 있다.
- 비동기 API의 예시로, setTimeout, XMLHttpRequest, fetch 등의 Web API가 있다.
- 비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 JS엔진을 구동하는 환경인 브라우저 또는 Node.js가 담당한다.
- JS엔진은 싱글 스레드 방식으로 동작하지만 이는 브라우저가 아니라 브라우저에 내장된 JS엔진이다. 브라우저는 멀티 스레드로 동작을 하고 이는 JS를 비동기로 동작할 수 있게 해 준다.

### 태스크 큐(task queue / event queue / callback queue)

- 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역이다.
- 태스크 큐는 Microtask Queue, Animation Frames 등 여러개의 큐로 이루어져 있다.
    - 마이크로태스크 큐: 프로미스의 후속 처리 메서드의 콜백 함수가 일시적으로 보관되는

## 이밴트 루프(Event loop)

- 자바스크립트의 동시성(concurrency)을 지원하는 것이 바로 이벤트 루프이다.
- 브라우저에 내장되어 있는 기능 중 하나이다.
- 콜 스택에 현재 실행 컨텍스트가 있는지, 그리고 태스크 큐에 대기 중인 함수(콜백 함수, 이벤트 헨들러 등)가 있는지 반복해서 확인한다.
- 만약 콜 스택이 비어있고 태스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적(FIFO)으로 테스크 큐에 대기중인 함수를 콜 스택으로 이동시킨다.
- 이 때 콜 스택으로 이동한 함수는 실행된다. 즉 태스크 큐에 일시 보관된 함수들은 비동기 처리 방식으로 동작한다.

## 결론

<aside>
📌 JS는 싱글 스레드 방식으로 동작하지만 이는 브라우저가 아니라 브라우저에 내장된 JS엔진이다. 
브라우저는 멀티 스레드로 동작을 하고 이는 JS를 비동기로 동작할 수 있게 해 준다.
</aside>

### 연관 질문
- 자바스크립트 엔진의 특징에 대해 설명하세요.
- 멀티 스레드처럼 사용되는데 어떻게 가능한지 설명하세요.
- 동기와 비동기의 차이점에 대해서 설명하세요.
- 이벤트 루프와 태스크 큐에 대해서 설명하세요.

### 확장 개념
- 동기 함수와 비동기 함수
- callback vs Promise vs async await

### 더 알아보기
**V8엔진**

브라우저를 만드는 데 기반을 제공하는 오픈 소스 자바스크립트 엔진. 
구글 크롬 브라우저와 안드로이드 브라우저에 탑재되어 있다.

브랜치 테스트
수정 테스트